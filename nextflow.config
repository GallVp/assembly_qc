includeConfig './conf/base.config'

params {
    
    // FASTA files (fasta, fasta.gz) for the assemblies to QC
    //
    // Pattern:               [["tag", "file path"]]
    // Permissible tags:      tag, tag_1, tag_tag2_3, tag_tag2_tag3;
    //                        Any name with alphanumeric characters including "_".
    //                        "." is not allowed in the tag name
    //                        Unique, short tags are recommended.
    //                        Otherwise, some of the plots in the report may not display correctly.
    // Examples:
    // target_assemblies    = [["hap1", "./a/relative/path/to/the/fasta/file.fasta"],
    //                          ["hap2", "./a/relative/path/to/the/fasta/file2.fasta"], ...]
    // target_assemblies    = [["red5", "/an/absolute/path/to/the/fasta/file.fasta"]]
    target_assemblies       = [["hap1", "./test_data/test_data1.fasta.gz"],
                                ["hap2", "./test_data/test_data2.fasta"]]

    // GFF3 files (gff3, gff3.gz) for the assemblies to QC
    //
    // Optional             Set to [] if not needed such as assembly_gff3 = []
    //
    // Not all assembly gff3 files have to be provided such as:
    // assembly_gff3        = [["hap1", "./test_data/test_data1.gff3"]]
    //
    // Each gff3 file should have an associated (by tag) fasta file in target_assemblies.
    //
    // Multiple gff3 files can be associated (by tag) with a single fasta file in target_assemblies.
    assembly_gff3           = [["hap1", "./test_data/test_data1.gff3.gz"],
                               ["hap2", "./test_data/test_data2.gff3"]]
    
    assamblathon_stats {
        // The number of 'N's for the unknown gap size.
        // This number is used to split the scaffolds into contigs
        // to compute contig-related stats such as the number of contigs, N50, etc.
        // NCBI recommendation(https://www.ncbi.nlm.nih.gov/genbank/wgs_gapped/) is 100
        n_limit             = 100
    }

    ncbi_fcs_adaptor {
        skip                = 0 // 1: Skip, 0: Don't

        empire              = 'euk' // euk: Eukaryote, prok: Prokaryote

        // For interpretation of results, see:
        // https://github.com/ncbi/fcs/wiki/FCS-adaptor#rules-for-action-assignment
        //
        // If adaptors are found, the pipeline stops with a report of adaptor contamination
    }

    ncbi_fcs_gx {
        // This is a very slow module. Skip it unless you really need it.
        skip                = 0

        // Get tax ID from https://www.ncbi.nlm.nih.gov/taxonomy
        // Example assembly is from Neonectria ditissima
        tax_id              = "78410"

        // NCBI FCS GX DB path
        // Due to enormity of the DB size, the pipeline does NOT download the data.
        // It must be setup by the user manually before running the pipeline.
        // See instructions for DB setup: https://github.com/ncbi/fcs/wiki/FCS-GX
        // db_manifest_url must match the downloaded DB otherwise the pipeline won't be able to
        // verify the integrity of the DB.
        db_manifest_url     = "https://ftp.ncbi.nlm.nih.gov/genomes/TOOLS/FCS/database/r2023-01-24/all.manifest"
        db_path             = "/workspace/ComparativeDataSources/NCBI/FCS/GX/r2023-01-24"

        // For interpretation of results, see:
        // https://github.com/ncbi/fcs/wiki/FCS-GX#fcs-gx-report-output
    }
    
    busco {
        skip                = 0
        
        // BUSCO runs for each assembly in combination with each lineage
        // Full cartesian product: Assembly x Lineage
        //
        // To select a lineage, see https://busco.ezlab.org/list_of_lineages.html
        lineage_datasets    = ["fungi_odb10", "microsporidia_odb10"]

        // BUSCO DB download path
        // The pipeline automatically downloads the required DB if needed
        download_path       = "/workspace/ComparativeDataSources/BUSCO/assembly_qc"
    }

    tidk {
        skip                = 0
        
        // To select an appropriate sequence, see http://telomerase.asu.edu/sequences_telomere.html
        // Plant: TTTAGGG, Fungus, Vertebrates: TTAGGG, Insect: TTAGG
        repeat_seq          = "TTAGGG"

        // 1: Filter assembly sequences by size, 0: Include all assembly sequences in the TIDK plot
        filter_by_size      = 0

        // Filter size in base-pairs. Any sequence smaller than this size is filtered if filter_by_size=1
        // Default: 1000000 (1Mbp)
        filter_size_bp      = 1000000
    }

    lai {
        // This is a very slow module. Skip it unless you really need it.
        skip                = 0

        // Available LAI modes are:
        // "": Standard
        // "-q" Quick
        //  "-qq" Very Quick. This mode is only valid for intra-species comparisons.
        mode                = ""

        // To avoid running EDTA before LAI, provide pass_list and out_file. If these files are not available,
        // simply set these variables to null.
        //
        // WARNING: Make sure the sequence ids in the fasta files provided by target_assemblies,
        // the pass_list file, and the out_file match.
        //
        // EDTA modifies the sequence names, if they are not short (<=13 characters)
        // and simple (i.e, letters, numbers, and underscore).
        //
        // Pattern:
        // pass_list        = [["hap_name", "file_path"], ["hap_name", "file_path"]]
        pass_list           = null
        out_file            = null
        
        edta {
            // 1: Sensitive (very slow), 0: Not sensitive
            //
            // Time requirements
            // 120 Mbp Assembly     --> 11.hours    (is_sensitive = 1)
            // 600 Mbp Assembly     --> 15.hours    (is_sensitive = 0), 100.hours   (is_sensitive = 1)
            // 2.4 Gbp Assembly     --> 100.hours   (is_sensitive = 0)
            //
            // LAI score: We don't have evidence for difference in LAI score for is_sensitive = 0 or 1
            //
            // Tair10               --> 17.90       (is_sensitive = 0), 17.87       (is_sensitive = 1)
            // Donghong             --> 19.03       (is_sensitive = 0), 19.04       (is_sensitive = 1)
            is_sensitive    = 0
        }
    }

    kraken2 {
        skip                = 0

        // To select a DB, see https://benlangmead.github.io/aws-indexes/k2
        // The pipeline automatically downloads the required DB if needed
        //
        // Using PlusPFP: archaea, viral, plasmid, human, UniVec_Core, protozoa, fungi & plant
        db_url              = "https://genome-idx.s3.amazonaws.com/kraken/k2_pluspfp_20230314.tar.gz"
        download_path       = "/workspace/ComparativeDataSources/kraken2db/k2_pluspfp_20230314"
    }

    hic {
        skip                = 0
        
        reads_folder        = "/input/genomic/fungal/Neonectria/Genome/20190506_CAGRF19591_CGYCF_HiC"
        paired_reads        = "${reads_folder}/PG_PETUNIA_HiC_CGYCF_CACTCA_L001_R{1,2}.fastq.gz"
    }

    synteny {
        skip                = 0

        between_target_asm  = 1 // 1: Create syntenic plots between each pair of target_assemblies, 0: Don't

        // Assembly sequence list
        // A two column tab-delimited txt file listing fatsa sequence ids (first column) and
        // labels for the synteny plots (second column).
        // When plotting synteny, these files are used to align the first sequence from query assembly against
        // the first sequence from the reference assembly.
        //
        // WARNING: If a sequence is missing from this file, it is excluded from the synteny plot even if
        // it is present in the fasta file.
        //
        // WARNING: The sequence labels (second column) must be unique across the synteny assemblies.
        // Otherwise, the pipeline fails with an error.
        // 
        // Example tab-delimited file contents are listed here:
        // Nd324_chr_1  ND_1
        // Nd324_chr_2  ND_2
        //
        // Pattern:           [["tag", "path to assembly sequence list"]]
        assembly_seq_list   = [["hap1", "./test_data/test_data1.seq.list"],
                               ["hap2", "./test_data/test_data2.seq.list"]]

        
        // A list of reference assemblies.
        // Syntenic plots are created between each assembly from target_assemblies and xref_assemblies.
        //
        // Optional           Can be set to [] if not needed such as xref_assemblies = []
        // In this case, the synteny is only performed between target assemblies if between_target_asm is 1.
        //
        // Pattern:           [["tag", "fasta file (fasta, fasta.gz) path", "seq.list file path"]]
        xref_assemblies     = [["GenomeA", "./test_data/test_data3.fasta", "./test_data/test_data3.seq.list"],
                               ["GenomeB", "./test_data/test_data4.fasta.gz", "./test_data/test_data4.seq.list"]]

        // 0: Only include alignment blocks with 1-to-1 mappings (dnadiff .1coords file)
        // 1: Include alignment blocks with many-to-many mappings (dnadiff .mcoords file)
        many_to_many_align  = 0

        max_gap             = 1000000   // 1 Mbp; Alignments within this distance are bundled together
        min_bundle_size     = 1000      // 1 Kbp; After bundling, any bundle smaller than this size is filtered out

        // 1: Plot synteny for each contig of target assembly versus all contigs of reference assembly
        // 0: Only plot synteny for all contigs of target assembly versus all contigs of reference assembly
        plot_1_vs_all       = 1

        // 1: Synteny plot is colored by contig
        // 0: Synteny plot is colored by number of links in the bundle
        color_by_contig     = 1
    }
    
    outdir {
        main                = "./results"
    }

    
    // The resources are capped at their following maximum values.
    // The pipeline does not use additional resources even if
    // the following values are increased. These values only set the
    // upper bound.
    //
    // To truly increase the max resources above the following values,
    // change the process classes defined in './conf/base.config'.
    max_cpus                = 12

    // NCBI_FCS_GX requires at least 512 GBs
    max_memory              = 512.GB
    
    // LAI::EDTA can take up to a week
    //
    // 120 Mbp Assembly     --> 11.hours    (is_sensitive = 1)
    // 600 Mbp Assembly     --> 15.hours    (is_sensitive = 0), 100.hours   (is_sensitive = 1)
    // 2.4 Gbp Assembly     --> 100.hours   (is_sensitive = 0)
    max_time                = 7.days
}

singularity {
    // This is where the pipeline looks for and stores the singularity
    // containers.
    cacheDir                = "/workspace/assembly_qc/singularity"
}

includeConfig './conf/module_defaults.config'
